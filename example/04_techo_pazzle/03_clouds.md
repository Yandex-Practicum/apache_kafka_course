# Зачем нам в облако

В предыдущих уроках вы работали над развёртыванием приложений и сервисов локально, на собственных компьютерах. Это предоставляет большую гибкость и контроль, но также влечёт за собой и ограничения. Например, ресурсы вашего компьютера могут ограничивать количество сервисов, которые можно запускать, или масштаб, на котором можно их тестировать. Также это требует постоянного участия в обслуживании и поддержке этих систем.

В этом контексте можно было бы обратиться к более мощным решениям, таким как собственные серверы, которые имеют больше вычислительной мощности и больше ресурсов, чем обычные домашние компьютеры. Однако, вместе с увеличением мощности, возрастает и сложность управления и поддержки этих систем, а также увеличиваются затраты на их эксплуатацию.

Именно здесь на помощь приходят облачные вычисления. Вместо использования собственного жёсткого оборудования, можно использовать ресурсы предоставляемые посредством интернета, и обрабатывать, хранить и управлять данными на удалённых серверах.

## Виртуальные машины в облаке

Основной блок облачных вычислений — это **виртуальная машина** (ВМ). Виртуальная машина — это эмуляция реального физического компьютера, которая работает внутри хост-системы. Такая эмуляция включает в себя операционную систему, программное обеспечение и приложения, которые обычно работают на физическом компьютере.

В контексте облачных вычислений виртуальные машины предоставляются облачными провайдерами как услуга (от англ. IaaS, Infrastructure as a Service — Инфраструктура как Услуга). Эти ВМ-ы предоставляют пользователям гибкость в выборе типа и размера экземпляра, что позволяет им подобрать ресурсы под свои конкретные нужды: определённые требования к производительности, ёмкости хранения данных, пропускной способности сети и другие.

Виртуальные машины предоставляют изолированную среду для работы приложений: каждая ВМ имеет собственные ресурсы (процессор, память, сеть, хранилище), которые изолированы от других ВМ. Это обеспечивает высокую степень безопасности и контроля над рабочей нагрузкой и позволяет независимо масштабировать каждую ВМ в соответствии с потребностями приложения.

Использование виртуальных машин в облачной среде также предоставляет возможность быстро создавать и уничтожать машины по мере необходимости, что является одним из основных преимуществ использования облачных вычислений.

Создадим свою ВМ с использованием Яндекс Облака! 

## Создание ВМ

Для начала перейдите на главную страницу [Yandex Cloud](https://cloud.yandex.ru){target="_blank"} и в правом верхнем углу кликните на **Подключиться**.

![](https://github.com/Yandex-Practicum/python_p2f_ugc/blob/d12e3a536eaea5f6cbe0ca73d29913f4949315b1/8th-sprint-refactor/04_techo_pazzle/images/welcome_fin.png)

Подтверждаем пользовательское соглашение.

![](https://github.com/Yandex-Practicum/python_p2f_ugc/blob/d12e3a536eaea5f6cbe0ca73d29913f4949315b1/8th-sprint-refactor/04_techo_pazzle/images/agree_fin.png)

Далее придумываем имя для нашего облака.

![](https://github.com/Yandex-Practicum/python_p2f_ugc/blob/d12e3a536eaea5f6cbe0ca73d29913f4949315b1/8th-sprint-refactor/04_techo_pazzle/images/name_fin.png)

Отлично, вы попали в консоль! Через неё можно конфигурировать будущую ВМ. Но создать её пока ещё нельзя, нужно сначала создать платежный аккаунт. Кликаем на **Создать аккаунт**.

Заполняем всю платежную информацию, в том числе и банковскую карту. По поводу трат не переживайте — вам выдадут **промокод** на использование ресурсов облака.

![](https://github.com/Yandex-Practicum/python_p2f_ugc/blob/d12e3a536eaea5f6cbe0ca73d29913f4949315b1/8th-sprint-refactor/04_techo_pazzle/images/billing-account_fin.png)

Теперь можно активировать промокод:

1. В консоли управления, в правом верхнем углу, кликайте на лупу и ищите раздел [Биллинг](https://console.cloud.yandex.ru/billing?section=accounts){target="_blank"}.
2. Выберите аккаунт на странице Аккаунты.
3. Нажмите кнопку **Активировать промокод** на странице Данные аккаунта. Эта кнопка появляется только тогда, когда промокод стал доступен.
4. Введите промокод и нажмите кнопку **Активировать**.


Приступим к созданию ВМ! ВМ создаётся в одном из [каталогов](https://cloud.yandex.ru/docs/resource-manager/concepts/resources-hierarchy#folder){target="_blank"} в вашем облаке и наследует права доступа от них. [Подробнее о ресурсной модели Yandex Cloud](https://cloud.yandex.ru/docs/resource-manager/concepts/resources-hierarchy){target="_blank"}.

У каждой ВМ свой уникальный идентификатор и имя. Имя уникально в рамках каталога. Идентификатор генерируется автоматически при создании ВМ и уникален в пределах Yandex Cloud.

Чтобы создать виртуальную машину:

1. В [консоли управления](https://console.cloud.yandex.ru/){target="_blank"} выберите каталог, в котором будет создана ВМ.

2. В списке сервисов выберите Compute Cloud.

![](https://github.com/Yandex-Practicum/python_p2f_ugc/blob/d12e3a536eaea5f6cbe0ca73d29913f4949315b1/8th-sprint-refactor/04_techo_pazzle/images/create-1_fin.png)

3. Нажмите на кнопку **Создать ресурс**, в открывшимся окне выберите Виртуальная машина.

4. В блоке Базовые параметры:
   - Введите имя и описание ВМ. Требования к имени:
        - Длина от 3 до 63 символов.
        - Может содержать строчные буквы латинского алфавита, цифры и дефисы.
        - Первый символ — буква. Последний символ — не дефис.

В названии явно укажем, что на этой машине будет распологаться Kafka.

![](https://github.com/Yandex-Practicum/python_p2f_ugc/blob/d12e3a536eaea5f6cbe0ca73d29913f4949315b1/8th-sprint-refactor/04_techo_pazzle/images/create-2_fin.png)

5. В блоке Выбор образа/загрузочного диска выберите образ Ubuntu последней версии.

![](https://github.com/Yandex-Practicum/python_p2f_ugc/blob/d12e3a536eaea5f6cbe0ca73d29913f4949315b1/8th-sprint-refactor/04_techo_pazzle/images/create-3_fin.png)

6. В блоке Диски и файловые хранилища нажмите **Добавить диск**. В открывшимся окне оставьте все настройки по умолчанию, кроме следующих пунктов:
   - Наполнение — поставьте Диск.
   - Дополнительно — Удалять вместе с ВМ.

![](https://github.com/Yandex-Practicum/python_p2f_ugc/blob/d12e3a536eaea5f6cbe0ca73d29913f4949315b1/8th-sprint-refactor/04_techo_pazzle/images/create-4_fin.png)

7. В блоке Вычислительные ресурсы:
    - Платформу оставьте по умолчанию.
    - vCPU — 2.
    - Гарантированная доля vCPU — 20%.
    - RAM — 6 ГБ.

![](https://github.com/Yandex-Practicum/python_p2f_ugc/blob/d12e3a536eaea5f6cbe0ca73d29913f4949315b1/8th-sprint-refactor/04_techo_pazzle/images/create-5_fin.png)

8. В блоке Сетевые настройки:
    - Укажите идентификатор подсети или выберите облачную сеть из списка. Если сети нет, нажмите **Создать сеть** и создайте её:
        - В открывшемся окне укажите имя сети и каталог, в котором она будет создана.
        - (опционально) Для автоматического создания подсетей выберите опцию Создать подсети.
        - Нажмите **Создать**. У каждой сети должна быть как минимум одна подсеть. Если подсети нет, создайте её, выбрав **Добавить подсеть**.
    - В поле Публичный адрес выберите автоматический способ назначения адреса.
    - В поле Внутренний IPv4-адрес выберите автоматический способ назначения внутренних адресов.

![](https://github.com/Yandex-Practicum/python_p2f_ugc/blob/d12e3a536eaea5f6cbe0ca73d29913f4949315b1/8th-sprint-refactor/04_techo_pazzle/images/create-6_fin.png)

9. В блоке Доступ укажите данные для доступа на ВМ:
    - (опционально) Выберите или создайте сервисный аккаунт. Использование сервисного аккаунта позволяет гибко настраивать права доступа к ресурсам.
    - В поле Логин введите имя пользователя.
    - В поле SSH-ключ вставьте содержимое файла открытого ключа. Пару ключей для подключения по SSH необходимо [создать](https://cloud.yandex.ru/docs/compute/operations/vm-connect/ssh#creating-ssh-keys){target="_blank"} самостоятельно. Использовать ключи SSH более безопасно, чем использовать пару логин/пароль. Этот подход обеспечивает дополнительный уровень защиты для вашей виртуальной машины.

![](https://github.com/Yandex-Practicum/python_p2f_ugc/blob/d12e3a536eaea5f6cbe0ca73d29913f4949315b1/8th-sprint-refactor/04_techo_pazzle/images/create-7_fin.png)
   
10. Нажмите кнопку **Создать ВМ**.

ВМ появится в списке. Отлично!

## Подключение к ВМ

Вы можете подключиться к ВМ в статусе RUNNING по протоколу SSH. Для инициализации всех служб после запуска ВМ может потребоваться время. Если возникла ошибка соединения, попробуйте снова через несколько минут.

Для подключения необходимо указать [публичный IP-адрес](https://cloud.yandex.ru/docs/vpc/concepts/address#public-addresses){target="_blank"} ВМ. Публичный IP-адрес можно узнать в консоли управления в поле Публичный IPv4 блока Сеть на странице ВМ. Если вы создали ВМ только с внутренним IP-адресом, привяжите к ней публичный IP-адрес.

В терминале выполните команду:

```sh
ssh <имя_пользователя>@<публичный_IP-адрес_ВМ>
```

`<имя_пользователя>` — имя учетной записи пользователя ВМ.

{quiz-task} background: | #82bbf2 content: | **Важно**: публичный IP-адрес ВМ может меняться при перезагрузках или выключениях виртуальной машины. Актуальный IP-адрес вы всегда можете посмотреть в консоли облака. {/quiz-task}


## Переносим компоненты в облако

После того, как вы создали виртуальную машину в облачной среде и настроили все необходимые соединения, настало время развернуть компоненты вашей будущей системы. С этим поможет инструмент под названием docker-compose, которым вы уже пользовались ранее для локального развёртывания.

Первое, что нужно сделать, — это перенести файл docker-compose на виртуальную машину. Для этого можно использовать инструмент под названием scp (secure copy), который позволяет копировать файлы между хостами по сети. Он использует протокол SSH для передачи данных. Команда `scp` имеет следующий формат:

```sh
scp /path/to/local/file username@remote_host:/path/to/remote/directory
```

В этом случае, `/path/to/local/file` — это путь к файлу docker-compose.yml на вашем локальном компьютере, `username@remote_host` — это имя пользователя и адрес вашей виртуальной машины, а `/path/to/remote/directory` — это место на виртуальной машине, куда вы хотите поместить файл.

Дальше зайдите на сервер и проверьте наличие файла. Если всё в порядке, то смело запускайте его уже знакомой командой `docker-compose up -d`.

### Квиз

В чём преимущество использования облачных технологий в контексте отказоустойчивости?
* [ ] Облака берут на себя все проблемы с безопасностью.  
    > Хотя облачные сервисы обеспечивают некоторые меры безопасности, ответственность за безопасность данных и приложений всё равно остаётся на стороне пользователя. 
* [ ] При использовании облака вам никогда не придётся обновлять своё программное обеспечение.  
    > В то время как облачные провайдеры обновляют и поддерживают физические серверы и инфраструктуру, обновление и поддержка программного обеспечения, запущенного на этих серверах, остается ответственностью пользователя.
* [ ] Облачные сервисы гарантируют 100% доступность вашего сервиса.  
    > Хотя многие облачные провайдеры стремятся обеспечить максимальную доступность, гарантировать 100% доступность невозможно из-за неизбежности технических сбоев и других факторов.
* [x] Облачные технологии позволяют легко создавать и управлять резервными копиями данных. 
    > Облачные технологии обеспечивают инструменты и сервисы для автоматизации процесса резервного копирования данных, что упрощает создание, управление и восстановление резервных копий. Это способствует увеличению отказоустойчивости системы.


В чём заключается основное преимущество использования облачных сервисов с точки зрения управления инфраструктурой?
* [ ] Позволяет снизить затраты на инфраструктуру.  
    > Использование облачных сервисов часто выглядит более привлекательным по сравнению с управлением собственной инфраструктурой, особенно для стартапов и малых компаний, поскольку оно избавляет от необходимости вложений в дорогостоящее физическое оборудование и его обслуживание. Однако, в длительной перспективе стоимость использования облачных сервисов может превысить затраты на приобретение и поддержание собственной инфраструктуры,особенно при масштабировании бизнеса.
* [ ] Облака всегда предлагают более высокую производительность, чем собственные серверы.  
    > Производительность облачных сервисов зависит от множества факторов, включая конфигурацию виртуальных машин, используемые технологии и даже географическое расположение. В некоторых случаях серверы могут обеспечивать более высокую производительность для конкретных задач.
* [x] Гибкость и масштабируемость.  
    > Одним из главных преимуществ использования облачных сервисов является возможность быстро масштабировать ресурсы в соответствии с текущими потребностями. Это позволяет эффективно управлять инфраструктурой, быстро реагируя на изменения нагрузки.
* [ ] В облаке никогда не происходит сбоев.  
    > Несмотря на все преимущества облачных сервисов, они не являются непогрешимыми и могут подвергаться сбоям или простоям. Важно иметь стратегию восстановления после сбоя и стратегию резервного копирования для обеспечения непрерывности бизнеса.

